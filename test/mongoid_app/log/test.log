Creating scope :unread. Overwriting existing method InnerMessage::Message.unread.
Creating scope :unread. Overwriting existing method InnerMessage::Message.unread.
  MOPED: 127.0.0.1:27017 COMMAND      database=admin command={:ismaster=>1} runtime: 3.4360ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"$query"=>{}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4810ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c63d94417070ded0000000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 11.7300ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"$query"=>{}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.9740ms
  MOPED: 127.0.0.1:27017 COMMAND      database=admin command={:ismaster=>1} runtime: 1.4890ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67bd64d61630ab0000000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 291.8630ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67bd64d61630ab0000000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 1.1490ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c67bd64d61630ab0010000'), "user_id"=>BSON::ObjectId('53c67bd64d61630ab0000000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 2.1340ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c67bd64d61630ab0010000')} update={"$set"=>{"secret"=>"ef27418ee622a17740f4a0ffecb9222d"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.3910ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67bd64d61630ab0020000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5920ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67bd64d61630ab0020000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.7370ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67bd64d61630ab0030000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6750ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67bd64d61630ab0030000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6530ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c67bd64d61630ab0040000'), "user_id"=>BSON::ObjectId('53c67bd64d61630ab0030000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7290ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c67bd64d61630ab0040000')} update={"$set"=>{"secret"=>"a5ad8a02fcfa5d77912b54077a0d4210"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7870ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67bd64d61630ab0030000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.7450ms
----------------------------
InnerMessageTest: test_truth
----------------------------
  MOPED: 127.0.0.1:27017 COMMAND      database=admin command={:ismaster=>1} runtime: 1.5140ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67c454d61630ac0000000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5120ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67c454d61630ac0010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4660ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c67c454d61630ac0010000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3620ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c454d61630ac0010000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.7060ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0020000'), "user_id"=>BSON::ObjectId('53c67c454d61630ac0010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 2.4170ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0030000'), "to_id"=>BSON::ObjectId('53c67c454d61630ac0010000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c67c454d61630ac0000000'), "messageable_id"=>BSON::ObjectId('53c67c464d61630ac0020000'), "messageable_type"=>"InnerMessage::MessageBox"}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 2.1070ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c454d61630ac0010000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5530ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0040000'), "user_id"=>BSON::ObjectId('53c67c454d61630ac0010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6590ms
  MOPED: 127.0.0.1:27017 COMMAND      database=mongoid_app_test command={:count=>"inner_message_messages", :query=>{"messageable_id"=>BSON::ObjectId('53c67c464d61630ac0040000'), "messageable_type"=>"InnerMessage::MessageBox", "read"=>false}} runtime: 0.5560ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0050000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6870ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0060000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5440ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c67c464d61630ac0060000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.5900ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c464d61630ac0060000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4790ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0070000'), "user_id"=>BSON::ObjectId('53c67c464d61630ac0060000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4860ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0080000'), "to_id"=>BSON::ObjectId('53c67c464d61630ac0060000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c67c464d61630ac0050000'), "messageable_id"=>BSON::ObjectId('53c67c464d61630ac0070000'), "messageable_type"=>"InnerMessage::MessageBox"}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4790ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c464d61630ac0060000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4380ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0090000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4620ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac00a0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4100ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c67c464d61630ac00a0000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4670ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c464d61630ac00a0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6500ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac00b0000'), "user_id"=>BSON::ObjectId('53c67c464d61630ac00a0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4630ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac00c0000'), "to_id"=>BSON::ObjectId('53c67c464d61630ac00a0000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c67c464d61630ac0090000'), "messageable_id"=>BSON::ObjectId('53c67c464d61630ac00b0000'), "messageable_type"=>"InnerMessage::MessageBox"}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4710ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c464d61630ac00a0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4500ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac00d0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4350ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c464d61630ac00d0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4120ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac00e0000'), "user_id"=>BSON::ObjectId('53c67c464d61630ac00d0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6490ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c67c464d61630ac00e0000')} update={"$set"=>{"secret"=>"be13e8a78387285011771c54482fe8d8"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6660ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c464d61630ac00d0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5400ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac00f0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4740ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c464d61630ac00f0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4310ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0100000'), "user_id"=>BSON::ObjectId('53c67c464d61630ac00f0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4410ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c67c464d61630ac0100000')} update={"$set"=>{"secret"=>"322916fbcf2f9097578df374c1de3111"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5070ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0110000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4580ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c464d61630ac0110000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4360ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0120000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4770ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5310ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c67c464d61630ac0130000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4030ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c464d61630ac0130000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5290ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0140000'), "user_id"=>BSON::ObjectId('53c67c464d61630ac0130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4710ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0150000'), "to_id"=>BSON::ObjectId('53c67c464d61630ac0130000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c67c464d61630ac0120000'), "messageable_id"=>BSON::ObjectId('53c67c464d61630ac0140000'), "messageable_type"=>"InnerMessage::MessageBox"}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3730ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c464d61630ac0130000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4280ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0160000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4240ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0170000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4040ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c67c464d61630ac0170000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3690ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c464d61630ac0170000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4290ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0180000'), "user_id"=>BSON::ObjectId('53c67c464d61630ac0170000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4530ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0190000'), "to_id"=>BSON::ObjectId('53c67c464d61630ac0170000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c67c464d61630ac0160000'), "messageable_id"=>BSON::ObjectId('53c67c464d61630ac0180000'), "messageable_type"=>"InnerMessage::MessageBox"}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4670ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c464d61630ac0170000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4120ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac01a0000'), "user_id"=>BSON::ObjectId('53c67c464d61630ac0170000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3780ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_messages selector={"$query"=>{"messageable_id"=>BSON::ObjectId('53c67c464d61630ac01a0000'), "messageable_type"=>"InnerMessage::MessageBox"}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4860ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac01b0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5070ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac01c0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6320ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c67c464d61630ac01c0000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4100ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c464d61630ac01c0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4620ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac01d0000'), "user_id"=>BSON::ObjectId('53c67c464d61630ac01c0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5390ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac01e0000'), "to_id"=>BSON::ObjectId('53c67c464d61630ac01c0000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c67c464d61630ac01b0000'), "messageable_id"=>BSON::ObjectId('53c67c464d61630ac01d0000'), "messageable_type"=>"InnerMessage::MessageBox"}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4640ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c464d61630ac01c0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4050ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac01f0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4190ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0200000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4060ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c67c464d61630ac0200000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3340ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c464d61630ac0200000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4040ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0210000'), "user_id"=>BSON::ObjectId('53c67c464d61630ac0200000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4450ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0220000'), "to_id"=>BSON::ObjectId('53c67c464d61630ac0200000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c67c464d61630ac01f0000'), "messageable_id"=>BSON::ObjectId('53c67c464d61630ac0210000'), "messageable_type"=>"InnerMessage::MessageBox"}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4540ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c464d61630ac0200000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4360ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>10000} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3020ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0230000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4960ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0240000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4200ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c67c464d61630ac0240000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3570ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c464d61630ac0240000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4640ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0250000'), "user_id"=>BSON::ObjectId('53c67c464d61630ac0240000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4290ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0260000'), "to_id"=>BSON::ObjectId('53c67c464d61630ac0240000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c67c464d61630ac0230000'), "messageable_id"=>BSON::ObjectId('53c67c464d61630ac0250000'), "messageable_type"=>"InnerMessage::MessageBox"}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4690ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c67c464d61630ac0240000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5890ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c67c464d61630ac0270000'), "user_id"=>BSON::ObjectId('53c67c464d61630ac0240000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5920ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_messages selector={"$query"=>{"messageable_id"=>BSON::ObjectId('53c67c464d61630ac0270000'), "messageable_type"=>"InnerMessage::MessageBox"}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4990ms
----------------------------
InnerMessageTest: test_truth
----------------------------
  MOPED: 127.0.0.1:27017 COMMAND      database=admin command={:ismaster=>1} runtime: 1.4800ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56000000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4720ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4590ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c680284d61630b56010000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3770ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b56010000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5300ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56020000'), "user_id"=>BSON::ObjectId('53c680284d61630b56010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5890ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56030000'), "to_id"=>BSON::ObjectId('53c680284d61630b56010000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c680284d61630b56000000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c680284d61630b56020000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:37:44 UTC, "created_at"=>2014-07-16 13:37:44 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6020ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b56010000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5220ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56040000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 3.5080ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56050000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5380ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c680284d61630b56050000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4030ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b56050000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6270ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56060000'), "user_id"=>BSON::ObjectId('53c680284d61630b56050000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6420ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56070000'), "to_id"=>BSON::ObjectId('53c680284d61630b56050000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c680284d61630b56040000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c680284d61630b56060000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:37:44 UTC, "created_at"=>2014-07-16 13:37:44 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5320ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b56050000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4590ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56080000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4580ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56090000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3830ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c680284d61630b56090000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3420ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b56090000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4210ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c680284d61630b560a0000'), "user_id"=>BSON::ObjectId('53c680284d61630b56090000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4860ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c680284d61630b560b0000'), "to_id"=>BSON::ObjectId('53c680284d61630b56090000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c680284d61630b56080000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c680284d61630b560a0000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:37:44 UTC, "created_at"=>2014-07-16 13:37:44 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5340ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b56090000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4420ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c680284d61630b560c0000'), "user_id"=>BSON::ObjectId('53c680284d61630b56090000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4450ms
  MOPED: 127.0.0.1:27017 COMMAND      database=mongoid_app_test command={:count=>"inner_message_messages", :query=>{"messageable_id"=>BSON::ObjectId('53c680284d61630b560c0000'), "messageable_type"=>"InnerMessage::MessageBox", "read"=>false}} runtime: 0.5140ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c680284d61630b560d0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7240ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b560d0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4690ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c680284d61630b560e0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5010ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b560e0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6230ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c680284d61630b560f0000'), "user_id"=>BSON::ObjectId('53c680284d61630b560e0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6360ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c680284d61630b560f0000')} update={"$set"=>{"secret"=>"416fefeb9c0ebd2516e3f6ab180b8f3c"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6770ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b560e0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4950ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56100000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4920ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b56100000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4250ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56110000'), "user_id"=>BSON::ObjectId('53c680284d61630b56100000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4260ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c680284d61630b56110000')} update={"$set"=>{"secret"=>"571babbf24c9cfd29a6022fbd5e28bef"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5550ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56120000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4700ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4690ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c680284d61630b56130000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3640ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b56130000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4560ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56140000'), "user_id"=>BSON::ObjectId('53c680284d61630b56130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4430ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56150000'), "to_id"=>BSON::ObjectId('53c680284d61630b56130000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c680284d61630b56120000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c680284d61630b56140000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:37:44 UTC, "created_at"=>2014-07-16 13:37:44 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4900ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b56130000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4190ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56160000'), "user_id"=>BSON::ObjectId('53c680284d61630b56130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4260ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_messages selector={"$query"=>{"messageable_id"=>BSON::ObjectId('53c680284d61630b56160000'), "messageable_type"=>"InnerMessage::MessageBox"}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4300ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56170000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4290ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56180000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3660ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c680284d61630b56180000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3950ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b56180000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6040ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56190000'), "user_id"=>BSON::ObjectId('53c680284d61630b56180000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4530ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c680284d61630b561a0000'), "to_id"=>BSON::ObjectId('53c680284d61630b56180000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c680284d61630b56170000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c680284d61630b56190000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:37:44 UTC, "created_at"=>2014-07-16 13:37:44 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4320ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b56180000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4140ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c680284d61630b561b0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4330ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c680284d61630b561c0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6200ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c680284d61630b561c0000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4050ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b561c0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4500ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c680284d61630b561d0000'), "user_id"=>BSON::ObjectId('53c680284d61630b561c0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5320ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c680284d61630b561e0000'), "to_id"=>BSON::ObjectId('53c680284d61630b561c0000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c680284d61630b561b0000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c680284d61630b561d0000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:37:44 UTC, "created_at"=>2014-07-16 13:37:44 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4100ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b561c0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4210ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c680284d61630b561f0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4300ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56200000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3850ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c680284d61630b56200000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3370ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b56200000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4270ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56210000'), "user_id"=>BSON::ObjectId('53c680284d61630b56200000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4230ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56220000'), "to_id"=>BSON::ObjectId('53c680284d61630b56200000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c680284d61630b561f0000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c680284d61630b56210000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:37:44 UTC, "created_at"=>2014-07-16 13:37:44 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4450ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b56200000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4240ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56230000'), "user_id"=>BSON::ObjectId('53c680284d61630b56200000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4500ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_messages selector={"$query"=>{"messageable_id"=>BSON::ObjectId('53c680284d61630b56230000'), "messageable_type"=>"InnerMessage::MessageBox"}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5720ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56240000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4790ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56250000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4160ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c680284d61630b56250000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3490ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b56250000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4530ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56260000'), "user_id"=>BSON::ObjectId('53c680284d61630b56250000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4110ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c680284d61630b56270000'), "to_id"=>BSON::ObjectId('53c680284d61630b56250000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c680284d61630b56240000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c680284d61630b56260000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:37:44 UTC, "created_at"=>2014-07-16 13:37:44 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4340ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c680284d61630b56250000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4110ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>10000} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3090ms
----------------------------
InnerMessageTest: test_truth
----------------------------
  MOPED: 127.0.0.1:27017 COMMAND      database=admin command={:ismaster=>1} runtime: 1.4800ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84000000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5010ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5030ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c681954d61630b84010000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3810ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c681954d61630b84010000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5000ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84020000'), "user_id"=>BSON::ObjectId('53c681954d61630b84010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6480ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84030000'), "to_id"=>BSON::ObjectId('53c681954d61630b84010000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c681954d61630b84000000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c681954d61630b84020000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:43:49 UTC, "created_at"=>2014-07-16 13:43:49 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7100ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c681954d61630b84010000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.5470ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84040000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.1530ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84050000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.7770ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c681954d61630b84050000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3660ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c681954d61630b84050000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4940ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84060000'), "user_id"=>BSON::ObjectId('53c681954d61630b84050000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4400ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84070000'), "to_id"=>BSON::ObjectId('53c681954d61630b84050000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c681954d61630b84040000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c681954d61630b84060000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:43:49 UTC, "created_at"=>2014-07-16 13:43:49 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4590ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c681954d61630b84050000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.5660ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_messages selector={"_id"=>BSON::ObjectId('53c681954d61630b84070000')} update={"$set"=>{"read"=>true, "updated_at"=>2014-07-16 13:43:49 UTC}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 2.0230ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84080000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7370ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84090000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6040ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c681954d61630b84090000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4030ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c681954d61630b84090000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5150ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c681954d61630b840a0000'), "user_id"=>BSON::ObjectId('53c681954d61630b84090000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4970ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c681954d61630b840b0000'), "to_id"=>BSON::ObjectId('53c681954d61630b84090000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c681954d61630b84080000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c681954d61630b840a0000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:43:49 UTC, "created_at"=>2014-07-16 13:43:49 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4930ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c681954d61630b84090000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.4410ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c681954d61630b840c0000'), "user_id"=>BSON::ObjectId('53c681954d61630b84090000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.3210ms
  MOPED: 127.0.0.1:27017 COMMAND      database=mongoid_app_test command={:count=>"inner_message_messages", :query=>{"messageable_id"=>BSON::ObjectId('53c681954d61630b840c0000'), "messageable_type"=>"InnerMessage::MessageBox", "read"=>false}} runtime: 0.5070ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c681954d61630b840d0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.8450ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c681954d61630b840d0000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.5620ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c681954d61630b840e0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5840ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c681954d61630b840e0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6150ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c681954d61630b840f0000'), "user_id"=>BSON::ObjectId('53c681954d61630b840e0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6830ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c681954d61630b840f0000')} update={"$set"=>{"secret"=>"e6da244c697392c7e0379fb93ae165cf"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7640ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c681954d61630b840e0000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.4910ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84100000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4760ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c681954d61630b84100000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4720ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84110000'), "user_id"=>BSON::ObjectId('53c681954d61630b84100000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4670ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c681954d61630b84110000')} update={"$set"=>{"secret"=>"32ed4e438aea52df4f514113df499951"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5120ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84120000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4480ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4950ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c681954d61630b84130000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3610ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c681954d61630b84130000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4940ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84140000'), "user_id"=>BSON::ObjectId('53c681954d61630b84130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4930ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84150000'), "to_id"=>BSON::ObjectId('53c681954d61630b84130000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c681954d61630b84120000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c681954d61630b84140000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:43:49 UTC, "created_at"=>2014-07-16 13:43:49 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5580ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c681954d61630b84130000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.4120ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84160000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 2.9040ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84170000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5760ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c681954d61630b84170000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3790ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c681954d61630b84170000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4780ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84180000'), "user_id"=>BSON::ObjectId('53c681954d61630b84170000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 13.1500ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84190000'), "to_id"=>BSON::ObjectId('53c681954d61630b84170000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c681954d61630b84160000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c681954d61630b84180000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:43:49 UTC, "created_at"=>2014-07-16 13:43:49 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7960ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c681954d61630b84170000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.5160ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c681954d61630b841a0000'), "user_id"=>BSON::ObjectId('53c681954d61630b84170000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.5840ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_messages selector={"$query"=>{"messageable_id"=>BSON::ObjectId('53c681954d61630b841a0000'), "messageable_type"=>"InnerMessage::MessageBox"}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5430ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c681954d61630b841b0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5230ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c681954d61630b841c0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4420ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c681954d61630b841c0000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3620ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c681954d61630b841c0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4910ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c681954d61630b841d0000'), "user_id"=>BSON::ObjectId('53c681954d61630b841c0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5280ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c681954d61630b841e0000'), "to_id"=>BSON::ObjectId('53c681954d61630b841c0000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c681954d61630b841b0000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c681954d61630b841d0000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:43:49 UTC, "created_at"=>2014-07-16 13:43:49 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6830ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c681954d61630b841c0000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.4660ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>10000} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 1.5570ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c681954d61630b841f0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5170ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c681954d61630b84200000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4230ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c681954d61630b84200000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3610ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c681954d61630b84200000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4710ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c681964d61630b84210000'), "user_id"=>BSON::ObjectId('53c681954d61630b84200000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5220ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c681964d61630b84220000'), "to_id"=>BSON::ObjectId('53c681954d61630b84200000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c681954d61630b841f0000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c681964d61630b84210000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:43:50 UTC, "created_at"=>2014-07-16 13:43:50 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5090ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c681954d61630b84200000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.5630ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c681964d61630b84230000'), "user_id"=>BSON::ObjectId('53c681954d61630b84200000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4920ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_messages selector={"$query"=>{"messageable_id"=>BSON::ObjectId('53c681964d61630b84230000'), "messageable_type"=>"InnerMessage::MessageBox"}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4880ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c681964d61630b84240000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4970ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c681964d61630b84250000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4210ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c681964d61630b84250000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3460ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c681964d61630b84250000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6290ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c681964d61630b84260000'), "user_id"=>BSON::ObjectId('53c681964d61630b84250000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5500ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c681964d61630b84270000'), "to_id"=>BSON::ObjectId('53c681964d61630b84250000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c681964d61630b84240000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c681964d61630b84260000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:43:50 UTC, "created_at"=>2014-07-16 13:43:50 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4990ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c681964d61630b84250000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.4320ms
----------------------------
InnerMessageTest: test_truth
----------------------------
  MOPED: 127.0.0.1:27017 COMMAND      database=admin command={:ismaster=>1} runtime: 1.5880ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6000000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5050ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4510ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c6828c4d61630ba6010000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3720ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6828c4d61630ba6010000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5130ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6020000'), "user_id"=>BSON::ObjectId('53c6828c4d61630ba6010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6860ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6030000'), "to_id"=>BSON::ObjectId('53c6828c4d61630ba6010000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c6828c4d61630ba6000000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c6828c4d61630ba6020000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:47:56 UTC, "created_at"=>2014-07-16 13:47:56 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7110ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c6828c4d61630ba6010000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.5770ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6040000'), "user_id"=>BSON::ObjectId('53c6828c4d61630ba6010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 2.4230ms
  MOPED: 127.0.0.1:27017 COMMAND      database=mongoid_app_test command={:count=>"inner_message_messages", :query=>{"messageable_id"=>BSON::ObjectId('53c6828c4d61630ba6040000'), "messageable_type"=>"InnerMessage::MessageBox", "read"=>false}} runtime: 0.5910ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6050000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7500ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6060000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4520ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c6828c4d61630ba6060000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4380ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6828c4d61630ba6060000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5050ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6070000'), "user_id"=>BSON::ObjectId('53c6828c4d61630ba6060000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5610ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6080000'), "to_id"=>BSON::ObjectId('53c6828c4d61630ba6060000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c6828c4d61630ba6050000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c6828c4d61630ba6070000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:47:56 UTC, "created_at"=>2014-07-16 13:47:56 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4630ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c6828c4d61630ba6060000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.4770ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_messages selector={"_id"=>BSON::ObjectId('53c6828c4d61630ba6080000')} update={"$set"=>{"read"=>true, "updated_at"=>2014-07-16 13:47:56 UTC}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.9760ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6090000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7660ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba60a0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4790ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c6828c4d61630ba60a0000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4100ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6828c4d61630ba60a0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5220ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba60b0000'), "user_id"=>BSON::ObjectId('53c6828c4d61630ba60a0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4730ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba60c0000'), "to_id"=>BSON::ObjectId('53c6828c4d61630ba60a0000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c6828c4d61630ba6090000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c6828c4d61630ba60b0000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:47:56 UTC, "created_at"=>2014-07-16 13:47:56 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5390ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c6828c4d61630ba60a0000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.5030ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba60d0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.3660ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6828c4d61630ba60d0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5010ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba60e0000'), "user_id"=>BSON::ObjectId('53c6828c4d61630ba60d0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6120ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c6828c4d61630ba60e0000')} update={"$set"=>{"secret"=>"e2f048b11cf148e3ea58366893246815"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5590ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba60f0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4780ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c6828c4d61630ba60f0000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.4140ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6100000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4120ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6828c4d61630ba6100000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4190ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6110000'), "user_id"=>BSON::ObjectId('53c6828c4d61630ba6100000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3850ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c6828c4d61630ba6110000')} update={"$set"=>{"secret"=>"a62a7b8a8a6e68d5504904e80a8a35e5"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4520ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c6828c4d61630ba6100000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.4160ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6120000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4200ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3900ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c6828c4d61630ba6130000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3280ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6828c4d61630ba6130000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4580ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6140000'), "user_id"=>BSON::ObjectId('53c6828c4d61630ba6130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4330ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6150000'), "to_id"=>BSON::ObjectId('53c6828c4d61630ba6130000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c6828c4d61630ba6120000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c6828c4d61630ba6140000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:47:56 UTC, "created_at"=>2014-07-16 13:47:56 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5110ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c6828c4d61630ba6130000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.3710ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>10000} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 1.6850ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6160000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5270ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6170000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3750ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c6828c4d61630ba6170000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3160ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6828c4d61630ba6170000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4630ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6180000'), "user_id"=>BSON::ObjectId('53c6828c4d61630ba6170000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3960ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6190000'), "to_id"=>BSON::ObjectId('53c6828c4d61630ba6170000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c6828c4d61630ba6160000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c6828c4d61630ba6180000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:47:56 UTC, "created_at"=>2014-07-16 13:47:56 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4160ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c6828c4d61630ba6170000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.4300ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba61a0000'), "user_id"=>BSON::ObjectId('53c6828c4d61630ba6170000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 2.0000ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_messages selector={"$query"=>{"messageable_id"=>BSON::ObjectId('53c6828c4d61630ba61a0000'), "messageable_type"=>"InnerMessage::MessageBox"}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6670ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba61b0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 6.7510ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba61c0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6740ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c6828c4d61630ba61c0000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4880ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6828c4d61630ba61c0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.7720ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba61d0000'), "user_id"=>BSON::ObjectId('53c6828c4d61630ba61c0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4520ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba61e0000'), "to_id"=>BSON::ObjectId('53c6828c4d61630ba61c0000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c6828c4d61630ba61b0000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c6828c4d61630ba61d0000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:47:56 UTC, "created_at"=>2014-07-16 13:47:56 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5850ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c6828c4d61630ba61c0000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.4000ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba61f0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5810ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6200000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5330ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c6828c4d61630ba6200000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4230ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6828c4d61630ba6200000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5020ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6210000'), "user_id"=>BSON::ObjectId('53c6828c4d61630ba6200000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.8330ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6220000'), "to_id"=>BSON::ObjectId('53c6828c4d61630ba6200000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c6828c4d61630ba61f0000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c6828c4d61630ba6210000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:47:56 UTC, "created_at"=>2014-07-16 13:47:56 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4690ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c6828c4d61630ba6200000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.3800ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6230000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.4030ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6240000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4490ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c6828c4d61630ba6240000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.5560ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6828c4d61630ba6240000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5790ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6250000'), "user_id"=>BSON::ObjectId('53c6828c4d61630ba6240000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5370ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6260000'), "to_id"=>BSON::ObjectId('53c6828c4d61630ba6240000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c6828c4d61630ba6230000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c6828c4d61630ba6250000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:47:56 UTC, "created_at"=>2014-07-16 13:47:56 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4020ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"user_id"=>BSON::ObjectId('53c6828c4d61630ba6240000')} flags=[] limit=-1 skip=0 batch_size=nil fields={:_id=>1} runtime: 0.4760ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6828c4d61630ba6270000'), "user_id"=>BSON::ObjectId('53c6828c4d61630ba6240000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.8680ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_messages selector={"$query"=>{"messageable_id"=>BSON::ObjectId('53c6828c4d61630ba6270000'), "messageable_type"=>"InnerMessage::MessageBox"}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5630ms
----------------------------
InnerMessageTest: test_truth
----------------------------
  MOPED: 127.0.0.1:27017 COMMAND      database=admin command={:ismaster=>1} runtime: 2.1520ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8000000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5490ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4760ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c683ed4d61630bd8010000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3830ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd8010000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5010ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8020000'), "user_id"=>BSON::ObjectId('53c683ed4d61630bd8010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6450ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8030000'), "to_id"=>BSON::ObjectId('53c683ed4d61630bd8010000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c683ed4d61630bd8000000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c683ed4d61630bd8020000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:53:49 UTC, "created_at"=>2014-07-16 13:53:49 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6820ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd8010000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5620ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8040000'), "user_id"=>BSON::ObjectId('53c683ed4d61630bd8010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 2.3850ms
  MOPED: 127.0.0.1:27017 COMMAND      database=mongoid_app_test command={:count=>"inner_message_messages", :query=>{"messageable_id"=>BSON::ObjectId('53c683ed4d61630bd8040000'), "messageable_type"=>"InnerMessage::MessageBox", "read"=>false}} runtime: 0.6200ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8050000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7060ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8060000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4530ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c683ed4d61630bd8060000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4680ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd8060000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6380ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8070000'), "user_id"=>BSON::ObjectId('53c683ed4d61630bd8060000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4610ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8080000'), "to_id"=>BSON::ObjectId('53c683ed4d61630bd8060000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c683ed4d61630bd8050000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c683ed4d61630bd8070000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:53:49 UTC, "created_at"=>2014-07-16 13:53:49 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4580ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd8060000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4180ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_messages selector={"_id"=>BSON::ObjectId('53c683ed4d61630bd8080000')} update={"$set"=>{"read"=>true, "updated_at"=>2014-07-16 13:53:49 UTC}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 7.6060ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8090000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7150ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd80a0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6030ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c683ed4d61630bd80a0000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.5040ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd80a0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.7940ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd80b0000'), "user_id"=>BSON::ObjectId('53c683ed4d61630bd80a0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7000ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd80c0000'), "to_id"=>BSON::ObjectId('53c683ed4d61630bd80a0000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c683ed4d61630bd8090000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c683ed4d61630bd80b0000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:53:49 UTC, "created_at"=>2014-07-16 13:53:49 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5440ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd80a0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4550ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd80d0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.6910ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd80d0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5120ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd80e0000'), "user_id"=>BSON::ObjectId('53c683ed4d61630bd80d0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6380ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c683ed4d61630bd80e0000')} update={"$set"=>{"secret"=>"4de594553def1a144e71efb353b4fa48"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6630ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd80f0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4400ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd80f0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.7610ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8100000'), "user_id"=>BSON::ObjectId('53c683ed4d61630bd80f0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5000ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c683ed4d61630bd8100000')} update={"$set"=>{"secret"=>"3ef7cf530754979647d1c30621b6d95c"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6040ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd80f0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4640ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8110000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7540ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd8110000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5030ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8120000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4760ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4060ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c683ed4d61630bd8130000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3480ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd8130000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4830ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8140000'), "user_id"=>BSON::ObjectId('53c683ed4d61630bd8130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4470ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8150000'), "to_id"=>BSON::ObjectId('53c683ed4d61630bd8130000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c683ed4d61630bd8120000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c683ed4d61630bd8140000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:53:49 UTC, "created_at"=>2014-07-16 13:53:49 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4840ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd8130000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5940ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8160000'), "user_id"=>BSON::ObjectId('53c683ed4d61630bd8130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.9300ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_messages selector={"$query"=>{"messageable_id"=>BSON::ObjectId('53c683ed4d61630bd8160000'), "messageable_type"=>"InnerMessage::MessageBox"}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6640ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8170000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6260ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8180000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4150ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c683ed4d61630bd8180000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3650ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd8180000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4670ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8190000'), "user_id"=>BSON::ObjectId('53c683ed4d61630bd8180000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4400ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd81a0000'), "to_id"=>BSON::ObjectId('53c683ed4d61630bd8180000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c683ed4d61630bd8170000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c683ed4d61630bd8190000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:53:49 UTC, "created_at"=>2014-07-16 13:53:49 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6700ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd8180000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5850ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd81b0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.7430ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd81c0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4620ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c683ed4d61630bd81c0000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3690ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd81c0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5140ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd81d0000'), "user_id"=>BSON::ObjectId('53c683ed4d61630bd81c0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4210ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd81e0000'), "to_id"=>BSON::ObjectId('53c683ed4d61630bd81c0000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c683ed4d61630bd81b0000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c683ed4d61630bd81d0000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:53:49 UTC, "created_at"=>2014-07-16 13:53:49 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4300ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd81c0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4110ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd81f0000'), "user_id"=>BSON::ObjectId('53c683ed4d61630bd81c0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.3720ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_messages selector={"$query"=>{"messageable_id"=>BSON::ObjectId('53c683ed4d61630bd81f0000'), "messageable_type"=>"InnerMessage::MessageBox"}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5160ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8200000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4320ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8210000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3990ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c683ed4d61630bd8210000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3420ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd8210000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4720ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8220000'), "user_id"=>BSON::ObjectId('53c683ed4d61630bd8210000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4430ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8230000'), "to_id"=>BSON::ObjectId('53c683ed4d61630bd8210000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c683ed4d61630bd8200000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c683ed4d61630bd8220000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:53:49 UTC, "created_at"=>2014-07-16 13:53:49 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4430ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd8210000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4290ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8240000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.4990ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8250000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5200ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c683ed4d61630bd8250000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.5490ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd8250000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6270ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8260000'), "user_id"=>BSON::ObjectId('53c683ed4d61630bd8250000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6880ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c683ed4d61630bd8270000'), "to_id"=>BSON::ObjectId('53c683ed4d61630bd8250000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c683ed4d61630bd8240000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c683ed4d61630bd8260000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:53:49 UTC, "created_at"=>2014-07-16 13:53:49 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4530ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c683ed4d61630bd8250000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4130ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>10000} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 2.0520ms
----------------------------
InnerMessageTest: test_truth
----------------------------
  MOPED: 127.0.0.1:27017 COMMAND      database=admin command={:ismaster=>1} runtime: 1.4500ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2000000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.9410ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5840ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c6840b4d61630be2010000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3940ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be2010000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5940ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2020000'), "user_id"=>BSON::ObjectId('53c6840b4d61630be2010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6240ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2030000'), "to_id"=>BSON::ObjectId('53c6840b4d61630be2010000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c6840b4d61630be2000000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c6840b4d61630be2020000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:54:19 UTC, "created_at"=>2014-07-16 13:54:19 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6170ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be2010000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5410ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2040000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 3.7450ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2050000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7440ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c6840b4d61630be2050000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4820ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be2050000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5510ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2060000'), "user_id"=>BSON::ObjectId('53c6840b4d61630be2050000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4840ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2070000'), "to_id"=>BSON::ObjectId('53c6840b4d61630be2050000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c6840b4d61630be2040000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c6840b4d61630be2060000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:54:19 UTC, "created_at"=>2014-07-16 13:54:19 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4310ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be2050000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5460ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_messages selector={"_id"=>BSON::ObjectId('53c6840b4d61630be2070000')} update={"$set"=>{"read"=>true, "updated_at"=>2014-07-16 13:54:19 UTC}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.5990ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2080000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5160ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2090000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4040ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c6840b4d61630be2090000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3480ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be2090000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4880ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be20a0000'), "user_id"=>BSON::ObjectId('53c6840b4d61630be2090000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5700ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be20b0000'), "to_id"=>BSON::ObjectId('53c6840b4d61630be2090000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c6840b4d61630be2080000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c6840b4d61630be20a0000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:54:19 UTC, "created_at"=>2014-07-16 13:54:19 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5790ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be2090000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4960ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be20c0000'), "user_id"=>BSON::ObjectId('53c6840b4d61630be2090000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.4290ms
  MOPED: 127.0.0.1:27017 COMMAND      database=mongoid_app_test command={:count=>"inner_message_messages", :query=>{"messageable_id"=>BSON::ObjectId('53c6840b4d61630be20c0000'), "messageable_type"=>"InnerMessage::MessageBox", "read"=>false}} runtime: 0.5130ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be20d0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7060ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be20d0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5210ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be20e0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4840ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be20e0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5320ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be20f0000'), "user_id"=>BSON::ObjectId('53c6840b4d61630be20e0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6770ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c6840b4d61630be20f0000')} update={"$set"=>{"secret"=>"09ab91039f20a1b8dc5f905eaf423d7f"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6060ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be20e0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6000ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2100000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6530ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be2100000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.7410ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2110000'), "user_id"=>BSON::ObjectId('53c6840b4d61630be2100000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4900ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c6840b4d61630be2110000')} update={"$set"=>{"secret"=>"254af7617b4eb0446a7754ee9b3efc2f"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5370ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2120000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7240ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5190ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c6840b4d61630be2130000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3920ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be2130000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5430ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2140000'), "user_id"=>BSON::ObjectId('53c6840b4d61630be2130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5060ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2150000'), "to_id"=>BSON::ObjectId('53c6840b4d61630be2130000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c6840b4d61630be2120000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c6840b4d61630be2140000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:54:19 UTC, "created_at"=>2014-07-16 13:54:19 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4720ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be2130000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4440ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2160000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.9430ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2170000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4610ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c6840b4d61630be2170000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3500ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be2170000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4630ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2180000'), "user_id"=>BSON::ObjectId('53c6840b4d61630be2170000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4730ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2190000'), "to_id"=>BSON::ObjectId('53c6840b4d61630be2170000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c6840b4d61630be2160000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c6840b4d61630be2180000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:54:19 UTC, "created_at"=>2014-07-16 13:54:19 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4390ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be2170000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4130ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be21a0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.8490ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be21b0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4680ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c6840b4d61630be21b0000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3910ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be21b0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.8240ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be21c0000'), "user_id"=>BSON::ObjectId('53c6840b4d61630be21b0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4790ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be21d0000'), "to_id"=>BSON::ObjectId('53c6840b4d61630be21b0000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c6840b4d61630be21a0000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c6840b4d61630be21c0000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:54:19 UTC, "created_at"=>2014-07-16 13:54:19 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4850ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be21b0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4350ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be21e0000'), "user_id"=>BSON::ObjectId('53c6840b4d61630be21b0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.4160ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_messages selector={"$query"=>{"messageable_id"=>BSON::ObjectId('53c6840b4d61630be21e0000'), "messageable_type"=>"InnerMessage::MessageBox"}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6920ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be21f0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5470ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2200000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3880ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c6840b4d61630be2200000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3450ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be2200000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4990ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2210000'), "user_id"=>BSON::ObjectId('53c6840b4d61630be2200000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4320ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2220000'), "to_id"=>BSON::ObjectId('53c6840b4d61630be2200000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c6840b4d61630be21f0000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c6840b4d61630be2210000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:54:19 UTC, "created_at"=>2014-07-16 13:54:19 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4230ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be2200000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4320ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2230000'), "user_id"=>BSON::ObjectId('53c6840b4d61630be2200000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.3930ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_messages selector={"$query"=>{"messageable_id"=>BSON::ObjectId('53c6840b4d61630be2230000'), "messageable_type"=>"InnerMessage::MessageBox"}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5480ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2240000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4430ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2250000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3920ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c6840b4d61630be2250000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3420ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be2250000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4860ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2260000'), "user_id"=>BSON::ObjectId('53c6840b4d61630be2250000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7810ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c6840b4d61630be2270000'), "to_id"=>BSON::ObjectId('53c6840b4d61630be2250000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c6840b4d61630be2240000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c6840b4d61630be2260000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 13:54:19 UTC, "created_at"=>2014-07-16 13:54:19 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 7.0430ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c6840b4d61630be2250000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.7450ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>10000} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 1.8040ms
----------------------------
InnerMessageTest: test_truth
----------------------------
  MOPED: 127.0.0.1:27017 COMMAND      database=admin command={:ismaster=>1} runtime: 1.4990ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c19000000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5320ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c19010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6250ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c685b84d61630c19010000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3740ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b84d61630c19010000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5750ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c19020000'), "user_id"=>BSON::ObjectId('53c685b84d61630c19010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7060ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c19030000'), "to_id"=>BSON::ObjectId('53c685b84d61630c19010000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c685b84d61630c19000000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c685b84d61630c19020000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 14:01:28 UTC, "created_at"=>2014-07-16 14:01:28 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6990ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b84d61630c19010000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6070ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c19040000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 2.5240ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c19050000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 5.6020ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c685b84d61630c19050000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.5380ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b84d61630c19050000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5980ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c19060000'), "user_id"=>BSON::ObjectId('53c685b84d61630c19050000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4640ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c19070000'), "to_id"=>BSON::ObjectId('53c685b84d61630c19050000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c685b84d61630c19040000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c685b84d61630c19060000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 14:01:28 UTC, "created_at"=>2014-07-16 14:01:28 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5130ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b84d61630c19050000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4410ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_messages selector={"_id"=>BSON::ObjectId('53c685b84d61630c19070000')} update={"$set"=>{"read"=>true, "updated_at"=>2014-07-16 14:01:28 UTC}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.7660ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c19080000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6050ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c19090000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4160ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c685b84d61630c19090000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3550ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b84d61630c19090000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6240ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c190a0000'), "user_id"=>BSON::ObjectId('53c685b84d61630c19090000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5350ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c190b0000'), "to_id"=>BSON::ObjectId('53c685b84d61630c19090000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c685b84d61630c19080000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c685b84d61630c190a0000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 14:01:28 UTC, "created_at"=>2014-07-16 14:01:28 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4620ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b84d61630c19090000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4340ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c190c0000'), "user_id"=>BSON::ObjectId('53c685b84d61630c19090000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.4340ms
  MOPED: 127.0.0.1:27017 COMMAND      database=mongoid_app_test command={:count=>"inner_message_messages", :query=>{"messageable_id"=>BSON::ObjectId('53c685b84d61630c190c0000'), "messageable_type"=>"InnerMessage::MessageBox", "read"=>false}} runtime: 0.5340ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c190d0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7130ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b84d61630c190d0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4890ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c190e0000'), "user_id"=>BSON::ObjectId('53c685b84d61630c190d0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5820ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c685b84d61630c190e0000')} update={"$set"=>{"secret"=>"e73e30230d977d91925bf24a021eaa6d"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7120ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c190f0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4680ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b84d61630c190f0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4680ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c19100000'), "user_id"=>BSON::ObjectId('53c685b84d61630c190f0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3950ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c685b84d61630c19100000')} update={"$set"=>{"secret"=>"37da100a1527683de62e4d764a912fff"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4620ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b84d61630c190f0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4780ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c19110000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4200ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b84d61630c19110000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5680ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c19120000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6660ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c19130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4770ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c685b84d61630c19130000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4300ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b84d61630c19130000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6150ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c19140000'), "user_id"=>BSON::ObjectId('53c685b84d61630c19130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5120ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c685b84d61630c19150000'), "to_id"=>BSON::ObjectId('53c685b84d61630c19130000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c685b84d61630c19120000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c685b84d61630c19140000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 14:01:28 UTC, "created_at"=>2014-07-16 14:01:28 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6600ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b84d61630c19130000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5090ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>10000} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 1.6380ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c685b94d61630c19160000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5230ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c685b94d61630c19170000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4100ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c685b94d61630c19170000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3360ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b94d61630c19170000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5090ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c685b94d61630c19180000'), "user_id"=>BSON::ObjectId('53c685b94d61630c19170000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3960ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c685b94d61630c19190000'), "to_id"=>BSON::ObjectId('53c685b94d61630c19170000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c685b94d61630c19160000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c685b94d61630c19180000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 14:01:29 UTC, "created_at"=>2014-07-16 14:01:29 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.8280ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b94d61630c19170000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6480ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c685b94d61630c191a0000'), "user_id"=>BSON::ObjectId('53c685b94d61630c19170000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.5480ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_messages selector={"$query"=>{"messageable_id"=>BSON::ObjectId('53c685b94d61630c191a0000'), "messageable_type"=>"InnerMessage::MessageBox"}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6250ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c685b94d61630c191b0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4370ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c685b94d61630c191c0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3870ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c685b94d61630c191c0000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3410ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b94d61630c191c0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5220ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c685b94d61630c191d0000'), "user_id"=>BSON::ObjectId('53c685b94d61630c191c0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4180ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c685b94d61630c191e0000'), "to_id"=>BSON::ObjectId('53c685b94d61630c191c0000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c685b94d61630c191b0000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c685b94d61630c191d0000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 14:01:29 UTC, "created_at"=>2014-07-16 14:01:29 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4350ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b94d61630c191c0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5170ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c685b94d61630c191f0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.5590ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c685b94d61630c19200000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5440ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c685b94d61630c19200000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3420ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b94d61630c19200000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5090ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c685b94d61630c19210000'), "user_id"=>BSON::ObjectId('53c685b94d61630c19200000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4170ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c685b94d61630c19220000'), "to_id"=>BSON::ObjectId('53c685b94d61630c19200000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c685b94d61630c191f0000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c685b94d61630c19210000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 14:01:29 UTC, "created_at"=>2014-07-16 14:01:29 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4310ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b94d61630c19200000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4220ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c685b94d61630c19230000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.4430ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c685b94d61630c19240000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4760ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c685b94d61630c19240000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4210ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b94d61630c19240000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5870ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c685b94d61630c19250000'), "user_id"=>BSON::ObjectId('53c685b94d61630c19240000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4620ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c685b94d61630c19260000'), "to_id"=>BSON::ObjectId('53c685b94d61630c19240000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c685b94d61630c19230000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c685b94d61630c19250000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 14:01:29 UTC, "created_at"=>2014-07-16 14:01:29 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4660ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c685b94d61630c19240000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5820ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c685b94d61630c19270000'), "user_id"=>BSON::ObjectId('53c685b94d61630c19240000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.9070ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_messages selector={"$query"=>{"messageable_id"=>BSON::ObjectId('53c685b94d61630c19270000'), "messageable_type"=>"InnerMessage::MessageBox"}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6790ms
----------------------------
InnerMessageTest: test_truth
----------------------------
  MOPED: 127.0.0.1:27017 COMMAND      database=admin command={:ismaster=>1} runtime: 1.3600ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c59000000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4890ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c59010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5300ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c687a54d61630c59010000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3980ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c59020000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4590ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c59030000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3950ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c687a54d61630c59030000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3250ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c59040000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4230ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c59050000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4640ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c687a54d61630c59050000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4600ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c59060000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4540ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c687a54d61630c59060000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4800ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c59070000'), "user_id"=>BSON::ObjectId('53c687a54d61630c59060000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6100ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c687a54d61630c59070000')} update={"$set"=>{"secret"=>"bd9a02bd8296cdb374e46b1d84b5eb61"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6430ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c687a54d61630c59060000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6020ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c59080000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5160ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c687a54d61630c59080000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4840ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c59090000'), "user_id"=>BSON::ObjectId('53c687a54d61630c59080000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4230ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c687a54d61630c59090000')} update={"$set"=>{"secret"=>"fa3357cbf76094c7a838be29bb553dda"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4920ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c590a0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4380ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c687a54d61630c590a0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4330ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c590b0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7380ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c590c0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.8140ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c687a54d61630c590c0000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.5740ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c590d0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5420ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c590e0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4110ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c687a54d61630c590e0000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3410ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c590f0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4640ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c59100000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3880ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c687a54d61630c59100000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3420ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c59110000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4510ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c59120000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4070ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c687a54d61630c59120000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3610ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c59130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4800ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c687a54d61630c59140000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5090ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c687a54d61630c59140000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.5690ms
----------------------------
InnerMessageTest: test_truth
----------------------------
  MOPED: 127.0.0.1:27017 COMMAND      database=admin command={:ismaster=>1} runtime: 1.3700ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09000000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5490ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4420ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c68c154d61630d09010000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3660ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d09010000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5470ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09020000'), "user_id"=>BSON::ObjectId('53c68c154d61630d09010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5700ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09030000'), "to_id"=>BSON::ObjectId('53c68c154d61630d09010000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c68c154d61630d09000000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c68c154d61630d09020000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 14:28:37 UTC, "created_at"=>2014-07-16 14:28:37 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6010ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d09010000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5680ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_messages selector={"_id"=>BSON::ObjectId('53c68c154d61630d09030000')} update={"$set"=>{"read"=>true, "updated_at"=>2014-07-16 14:28:37 UTC}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 2.5780ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09040000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5800ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09050000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4140ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c68c154d61630d09050000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3440ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d09050000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5200ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09060000'), "user_id"=>BSON::ObjectId('53c68c154d61630d09050000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4650ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09070000'), "to_id"=>BSON::ObjectId('53c68c154d61630d09050000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c68c154d61630d09040000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c68c154d61630d09060000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 14:28:37 UTC, "created_at"=>2014-07-16 14:28:37 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5870ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d09050000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4980ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09080000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.5170ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09090000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4510ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c68c154d61630d09090000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3400ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d09090000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5830ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d090a0000'), "user_id"=>BSON::ObjectId('53c68c154d61630d09090000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4300ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d090b0000'), "to_id"=>BSON::ObjectId('53c68c154d61630d09090000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c68c154d61630d09080000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c68c154d61630d090a0000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 14:28:37 UTC, "created_at"=>2014-07-16 14:28:37 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4300ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d09090000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4210ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d090c0000'), "user_id"=>BSON::ObjectId('53c68c154d61630d09090000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 9.1720ms
  MOPED: 127.0.0.1:27017 COMMAND      database=mongoid_app_test command={:count=>"inner_message_messages", :query=>{"messageable_id"=>BSON::ObjectId('53c68c154d61630d090c0000'), "messageable_type"=>"InnerMessage::MessageBox", "read"=>false}} runtime: 0.5810ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d090d0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6500ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d090d0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5710ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d090e0000'), "user_id"=>BSON::ObjectId('53c68c154d61630d090d0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6690ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c68c154d61630d090e0000')} update={"$set"=>{"secret"=>"e07760e21496f974c33260f89901c5f9"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7710ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d090d0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5960ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d090f0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5390ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d090f0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4740ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09100000'), "user_id"=>BSON::ObjectId('53c68c154d61630d090f0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4860ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c68c154d61630d09100000')} update={"$set"=>{"secret"=>"4ee7743111abec836dc6e2dc1dc42d28"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5680ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09110000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3970ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d09110000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4450ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09120000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4540ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4080ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c68c154d61630d09130000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3600ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d09130000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6490ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09140000'), "user_id"=>BSON::ObjectId('53c68c154d61630d09130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6440ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09150000'), "to_id"=>BSON::ObjectId('53c68c154d61630d09130000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c68c154d61630d09120000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c68c154d61630d09140000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 14:28:37 UTC, "created_at"=>2014-07-16 14:28:37 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5080ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d09130000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4420ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09160000'), "user_id"=>BSON::ObjectId('53c68c154d61630d09130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5240ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_messages selector={"$query"=>{"messageable_id"=>BSON::ObjectId('53c68c154d61630d09160000'), "messageable_type"=>"InnerMessage::MessageBox"}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5240ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09170000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4630ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09180000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6080ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c68c154d61630d09180000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3740ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d09180000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6040ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09190000'), "user_id"=>BSON::ObjectId('53c68c154d61630d09180000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4270ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d091a0000'), "to_id"=>BSON::ObjectId('53c68c154d61630d09180000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c68c154d61630d09170000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c68c154d61630d09190000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 14:28:37 UTC, "created_at"=>2014-07-16 14:28:37 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4280ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d09180000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4480ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d091b0000'), "user_id"=>BSON::ObjectId('53c68c154d61630d09180000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.4450ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_messages selector={"$query"=>{"messageable_id"=>BSON::ObjectId('53c68c154d61630d091b0000'), "messageable_type"=>"InnerMessage::MessageBox"}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5550ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d091c0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4590ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d091d0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4270ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c68c154d61630d091d0000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3450ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d091d0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5730ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d091e0000'), "user_id"=>BSON::ObjectId('53c68c154d61630d091d0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4170ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d091f0000'), "to_id"=>BSON::ObjectId('53c68c154d61630d091d0000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c68c154d61630d091c0000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c68c154d61630d091e0000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 14:28:37 UTC, "created_at"=>2014-07-16 14:28:37 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4590ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d091d0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4300ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09200000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.4670ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09210000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4140ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c68c154d61630d09210000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3670ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d09210000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6790ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09220000'), "user_id"=>BSON::ObjectId('53c68c154d61630d09210000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4960ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09230000'), "to_id"=>BSON::ObjectId('53c68c154d61630d09210000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c68c154d61630d09200000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c68c154d61630d09220000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 14:28:37 UTC, "created_at"=>2014-07-16 14:28:37 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4420ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d09210000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4430ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>10000} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 1.2670ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09240000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4790ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09250000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3590ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c68c154d61630d09250000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3530ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d09250000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5160ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09260000'), "user_id"=>BSON::ObjectId('53c68c154d61630d09250000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4650ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c68c154d61630d09270000'), "to_id"=>BSON::ObjectId('53c68c154d61630d09250000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c68c154d61630d09240000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c68c154d61630d09260000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 14:28:37 UTC, "created_at"=>2014-07-16 14:28:37 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4190ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c68c154d61630d09250000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4410ms
----------------------------
InnerMessageTest: test_truth
----------------------------
  MOPED: 127.0.0.1:27017 COMMAND      database=admin command={:ismaster=>1} runtime: 1.5890ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40000000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6200ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4840ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c69aef4d61630f40010000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4800ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f40010000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6600ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40020000'), "user_id"=>BSON::ObjectId('53c69aef4d61630f40010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 5.0830ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40030000'), "to_id"=>BSON::ObjectId('53c69aef4d61630f40010000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c69aef4d61630f40000000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c69aef4d61630f40020000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 15:31:59 UTC, "created_at"=>2014-07-16 15:31:59 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7150ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f40010000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.7170ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40040000'), "user_id"=>BSON::ObjectId('53c69aef4d61630f40010000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 3.0650ms
  MOPED: 127.0.0.1:27017 COMMAND      database=mongoid_app_test command={:count=>"inner_message_messages", :query=>{"messageable_id"=>BSON::ObjectId('53c69aef4d61630f40040000'), "messageable_type"=>"InnerMessage::MessageBox", "read"=>false}} runtime: 0.5820ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40050000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.7620ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40060000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5440ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c69aef4d61630f40060000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4010ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f40060000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6940ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40070000'), "user_id"=>BSON::ObjectId('53c69aef4d61630f40060000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4980ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40080000'), "to_id"=>BSON::ObjectId('53c69aef4d61630f40060000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c69aef4d61630f40050000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c69aef4d61630f40070000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 15:31:59 UTC, "created_at"=>2014-07-16 15:31:59 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5040ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f40060000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5310ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40090000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 2.0620ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f400a0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4350ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c69aef4d61630f400a0000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3800ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f400a0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5490ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f400b0000'), "user_id"=>BSON::ObjectId('53c69aef4d61630f400a0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4180ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f400c0000'), "to_id"=>BSON::ObjectId('53c69aef4d61630f400a0000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c69aef4d61630f40090000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c69aef4d61630f400b0000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 15:31:59 UTC, "created_at"=>2014-07-16 15:31:59 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4780ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f400a0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4760ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_messages selector={"_id"=>BSON::ObjectId('53c69aef4d61630f400c0000')} update={"$set"=>{"read"=>true, "updated_at"=>2014-07-16 15:31:59 UTC}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.8500ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f400d0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5050ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f400d0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4840ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f400e0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4500ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f400e0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4450ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f400f0000'), "user_id"=>BSON::ObjectId('53c69aef4d61630f400e0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6210ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c69aef4d61630f400f0000')} update={"$set"=>{"secret"=>"8c7d1db92bb2207d9b8ea8aed2c73c00"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6380ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f400e0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4730ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40100000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5270ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f40100000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4880ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_tokens documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40110000'), "user_id"=>BSON::ObjectId('53c69aef4d61630f40100000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4650ms
  MOPED: 127.0.0.1:27017 UPDATE       database=mongoid_app_test collection=inner_message_message_tokens selector={"_id"=>BSON::ObjectId('53c69aef4d61630f40110000')} update={"$set"=>{"secret"=>"1e1bcc8df3294cd3f8183db9e5b36dc2"}} flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4810ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40120000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4180ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3850ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c69aef4d61630f40130000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4560ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f40130000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5700ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40140000'), "user_id"=>BSON::ObjectId('53c69aef4d61630f40130000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6480ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40150000'), "to_id"=>BSON::ObjectId('53c69aef4d61630f40130000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c69aef4d61630f40120000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c69aef4d61630f40140000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 15:31:59 UTC, "created_at"=>2014-07-16 15:31:59 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4710ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f40130000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4550ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>10000} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4120ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40160000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5290ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40170000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4110ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c69aef4d61630f40170000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3650ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f40170000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6370ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40180000'), "user_id"=>BSON::ObjectId('53c69aef4d61630f40170000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5180ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40190000'), "to_id"=>BSON::ObjectId('53c69aef4d61630f40170000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c69aef4d61630f40160000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c69aef4d61630f40180000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 15:31:59 UTC, "created_at"=>2014-07-16 15:31:59 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4800ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f40170000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6220ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f401a0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5560ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f401b0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4120ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c69aef4d61630f401b0000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3420ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f401b0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6310ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f401c0000'), "user_id"=>BSON::ObjectId('53c69aef4d61630f401b0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4300ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f401d0000'), "to_id"=>BSON::ObjectId('53c69aef4d61630f401b0000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c69aef4d61630f401a0000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c69aef4d61630f401c0000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 15:31:59 UTC, "created_at"=>2014-07-16 15:31:59 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4250ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f401b0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4300ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f401e0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.8500ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f401f0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 6.8630ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c69aef4d61630f401f0000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.4900ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f401f0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.8520ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40200000'), "user_id"=>BSON::ObjectId('53c69aef4d61630f401f0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.6970ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40210000'), "to_id"=>BSON::ObjectId('53c69aef4d61630f401f0000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c69aef4d61630f401e0000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c69aef4d61630f40200000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 15:31:59 UTC, "created_at"=>2014-07-16 15:31:59 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5110ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f401f0000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4580ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40220000'), "user_id"=>BSON::ObjectId('53c69aef4d61630f401f0000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 1.6720ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_messages selector={"$query"=>{"messageable_id"=>BSON::ObjectId('53c69aef4d61630f40220000'), "messageable_type"=>"InnerMessage::MessageBox"}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.6030ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40230000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4320ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=users documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40240000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.3620ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=users selector={"_id"=>BSON::ObjectId('53c69aef4d61630f40240000')} flags=[] limit=0 skip=0 batch_size=nil fields=nil runtime: 0.3410ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_boxes selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f40240000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5350ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40250000'), "user_id"=>BSON::ObjectId('53c69aef4d61630f40240000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4000ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_messages documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40260000'), "to_id"=>BSON::ObjectId('53c69aef4d61630f40240000'), "content"=>"I love ruby!", "from_id"=>BSON::ObjectId('53c69aef4d61630f40230000'), "read"=>false, "messageable_id"=>BSON::ObjectId('53c69aef4d61630f40250000'), "messageable_type"=>"InnerMessage::MessageBox", "updated_at"=>2014-07-16 15:31:59 UTC, "created_at"=>2014-07-16 15:31:59 UTC}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.4100ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_message_tokens selector={"$query"=>{"user_id"=>BSON::ObjectId('53c69aef4d61630f40240000')}, "$orderby"=>{:_id=>1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.4330ms
  MOPED: 127.0.0.1:27017 INSERT       database=mongoid_app_test collection=inner_message_message_boxes documents=[{"_id"=>BSON::ObjectId('53c69aef4d61630f40270000'), "user_id"=>BSON::ObjectId('53c69aef4d61630f40240000')}] flags=[]
                         COMMAND      database=mongoid_app_test command={:getlasterror=>1, :w=>1} runtime: 0.5910ms
  MOPED: 127.0.0.1:27017 QUERY        database=mongoid_app_test collection=inner_message_messages selector={"$query"=>{"messageable_id"=>BSON::ObjectId('53c69aef4d61630f40270000'), "messageable_type"=>"InnerMessage::MessageBox"}, "$orderby"=>{:_id=>-1}} flags=[] limit=-1 skip=0 batch_size=nil fields=nil runtime: 0.5370ms
----------------------------
InnerMessageTest: test_truth
----------------------------
